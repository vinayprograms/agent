NAME multi-tool-pipeline

# Example combining built-in tools, MCP tools, and skills
# Demonstrates the full capability stack

INPUT repo_url
INPUT branch DEFAULT "main"

AGENT planner FROM agents/optimist.md
AGENT executor FROM agents/security-auditor.md REQUIRES "reasoning-heavy"

GOAL clone "Clone $repo_url (branch: $branch). Shallow clone if possible."
GOAL scan "Scan for top 5 security issues. Critical/High only." USING executor
GOAL plan "Brief remediation plan: 1-2 sentences per issue." USING planner
GOAL report "Concise security report."

CONVERGE fix "Fix one critical issue per iteration. CONVERGED when critical issues fixed or blocked." WITHIN 3

RUN setup USING clone
RUN analysis USING scan, plan
RUN remediation USING fix
RUN final USING report
