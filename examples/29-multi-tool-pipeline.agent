NAME multi-tool-pipeline

# Example combining built-in tools, MCP tools, and skills
# Demonstrates the full capability stack

INPUT repo_url
INPUT branch DEFAULT "main"

AGENT planner FROM agents/optimist.md
AGENT executor FROM agents/security-auditor.md REQUIRES "reasoning-heavy"

GOAL clone "Clone repository from $repo_url (branch: $branch) to workspace"
GOAL scan "Scan codebase for security issues using available tools" USING executor
GOAL plan "Create remediation plan for identified issues" USING planner
GOAL report "Generate comprehensive security audit report"

CONVERGE fix "Generate patches for critical issues and verify they don't break functionality. Output CONVERGED when all issues are resolved or no more improvements possible." WITHIN 5

RUN setup USING clone
RUN analysis USING scan, plan
RUN remediation USING fix
RUN final USING report
